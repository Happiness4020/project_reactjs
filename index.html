<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nhật Ký Hải Trình - Trịnh Hòa</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;600;700&family=Noto+Sans:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="src/styles/diary.css" />
  </head>
  <body>
    <div class="main-container">
      <section class="hero-section">
        <div class="container-fluid">
          <div class="hero-content text-center">
            <div class="hero-icon">
              <i class="fas fa-ship"></i>
            </div>
            <h1 class="hero-title">Nhật Ký Hải Trình</h1>
            <p class="hero-meta">
              Hành trình vĩ đại của Đô đốc Trịnh Hòa - Khám phá bảy chuyến biển
              huyền thoại xuyên suốt châu Á và châu Phi (1405-1433)
            </p>
            <div class="hero-meta">
              <i class="fas fa-user-edit me-2"></i>
              Tác giả: Nhóm dự án • 2025
            </div>
          </div>
        </div>
      </section>

      <div class="container">
        <!-- Phần giới thiệu về Trịnh Hòa -->
        <section class="introduction-section">
          <h2 class="introduction-title">
            Khởi đầu hành trình: Trịnh Hòa và giấc mơ chinh phục biển
          </h2>
          <div class="introduction-content">
            <p>
              Hơn 600 năm trước, giữa thời kỳ hưng thịnh của triều Minh, Trịnh
              Hòa (郑和) – một thái giám gốc Hồi giáo người Vân Nam – đã trở
              thành đô đốc hải quân vĩ đại nhất trong lịch sử Trung Hoa. Sinh ra
              trong một gia đình thương nhân Hồi giáo. Từ nhỏ ông đã thông minh,
              ham học hỏi và sớm bộc lộ tài chỉ huy. Sau khi được tuyển vào
              cung, Trịnh Hòa theo hầu Hoàng đế Minh Thành Tổ Chu Đệ, rồi được
              giao trọng trách chỉ huy đoàn "Bảo thuyền" ra khơi.
            </p>
            <p>
              Từ năm 1405 - 1433, ông đã dẫn đầu bảy cuộc hải trình vĩ đại, vượt
              qua Ấn Độ Dương, ghé đến hơn ba mươi quốc gia và vùng lãnh thổ ở
              châu Á và châu Phi. Những chuyến đi ấy không chỉ thể hiện sức mạnh
              hàng hải của Trung Hoa thời Minh, mà còn mang theo thông điệp hòa
              bình, hữu nghị và giao lưu văn hóa giữa các dân tộc.
            </p>
          </div>
        </section>

        <nav class="voyage-nav">
          <ul
            class="nav nav-pills justify-content-center flex-wrap"
            role="tablist"
          >
            <li class="nav-item" role="presentation">
              <a class="nav-link" href="#" data-voyage="1">
                <i class="fas fa-anchor me-2"></i>Hành trình 1
              </a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" href="#" data-voyage="2">
                <i class="fas fa-compass me-2"></i>Hành trình 2
              </a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" href="#" data-voyage="3">
                <i class="fas fa-water me-2"></i>Hành trình 3
              </a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" href="#" data-voyage="4">
                <i class="fas fa-map-marked-alt me-2"></i>Hành trình 4
              </a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" href="#" data-voyage="5">
                <i class="fas fa-route me-2"></i>Hành trình 5
              </a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" href="#" data-voyage="6">
                <i class="fas fa-dharmachakra me-2"></i>Hành trình 6
              </a>
            </li>
            <li class="nav-item" role="presentation">
              <a class="nav-link" href="#" data-voyage="7">
                <i class="fas fa-flag-checkered me-2"></i>Hành trình 7
              </a>
            </li>
          </ul>
        </nav>

        <div id="chapters-container" class="chapter-grid">
          <div class="chapter-card" data-voyage="1">
            <div class="chapter-card-body">
              <div class="chapter-number">1.1</div>
              <h3 class="chapter-title"></h3>
              <div class="chapter-meta">
                <span class="meta-item">
                  <i class="fas fa-calendar-alt"></i>
                  <span></span>
                </span>
                <span class="meta-item">
                  <i class="fas fa-map-marker-alt"></i>
                  <span></span>
                </span>
              </div>
              <p class="chapter-preview"></p>
              <a href="#" class="read-more-btn">
                Đọc thêm <i class="fas fa-arrow-right ms-2"></i>
              </a>
            </div>
          </div>

          <div class="chapter-card" data-voyage="1">
            <div class="chapter-card-body">
              <div class="chapter-number">1.2</div>
              <h3 class="chapter-title"></h3>
              <div class="chapter-meta">
                <span class="meta-item">
                  <i class="fas fa-calendar-alt"></i>
                  <span></span>
                </span>
                <span class="meta-item">
                  <i class="fas fa-map-marker-alt"></i>
                  <span></span>
                </span>
              </div>
              <p class="chapter-preview"></p>
              <a href="#" class="read-more-btn">
                Đọc thêm <i class="fas fa-arrow-right ms-2"></i>
              </a>
            </div>
          </div>

          <div class="chapter-card" data-voyage="2">
            <div class="chapter-card-body">
              <div class="chapter-number">2.1</div>
              <h3 class="chapter-title"></h3>
              <div class="chapter-meta">
                <span class="meta-item">
                  <i class="fas fa-calendar-alt"></i>
                  <span></span>
                </span>
                <span class="meta-item">
                  <i class="fas fa-map-marker-alt"></i>
                  <span></span>
                </span>
              </div>
              <p class="chapter-preview"></p>
              <a href="#" class="read-more-btn">
                Đọc thêm <i class="fas fa-arrow-right ms-2"></i>
              </a>
            </div>
          </div>
        </div>

        <div id="empty-state" class="empty-state d-none">
          <i class="fas fa-search"></i>
          <h3>Không tìm thấy chương nào</h3>
          <p>Vui lòng chọn chuyến đi khác hoặc xem tất cả</p>
        </div>
      </div>

      <footer class="footer">
        <div class="container">
          <div class="footer-content">
            <div class="social-icons">
              <a href="#" aria-label="Facebook"
                ><i class="fab fa-facebook"></i
              ></a>
              <a href="#" aria-label="Twitter"
                ><i class="fab fa-twitter"></i
              ></a>
              <a href="#" aria-label="Instagram"
                ><i class="fab fa-instagram"></i
              ></a>
              <a href="#" aria-label="Youtube"
                ><i class="fab fa-youtube"></i
              ></a>
            </div>
            <div class="footer-links">
              <a href="#about">Giới thiệu</a>
              <a href="#contact">Liên hệ</a>
              <a href="#resources">Tài nguyên</a>
              <a href="#privacy">Chính sách</a>
            </div>
            <p class="mb-0">
              &copy; 2025 Nhật Ký Hải Trình - Dự án học tập về Đô đốc Trịnh Hòa
            </p>
          </div>
        </div>
      </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script type="module">
      import { VOYAGE_PAGE } from "./src/config.js";

      document.addEventListener("DOMContentLoaded", () => {
        // Ensure nav links point to voyage pages
        document.querySelectorAll("a[data-voyage]").forEach((a) => {
          const v = a.getAttribute("data-voyage");
          if (!v || v === "all") return;
          const expected = `${VOYAGE_PAGE}?v=${v}`;
          const current = a.getAttribute("href") || "";
          if (current !== expected) a.setAttribute("href", expected);
        });

        // Show only one representative card per voyage (first encountered)
        const container = document.getElementById("chapters-container");
        if (container) {
          const seen = new Set();
          const cards = Array.from(container.querySelectorAll(".chapter-card"));
          cards.forEach((card) => {
            const v = card.getAttribute("data-voyage") || "all";
            if (!seen.has(v)) {
              // mark as seen and update the read-more link to voyage page
              seen.add(v);
              const readMore = card.querySelector(".read-more-btn");
              if (readMore)
                readMore.setAttribute("href", `${VOYAGE_PAGE}?v=${v}`);

              // Optionally update title to include voyage label (e.g., "Hành trình 1")
              const title = card.querySelector(".chapter-title");
              if (title) {
                // Prepend voyage indicator if not already present
                const prefix = `Hành trình ${v} — `;
                if (!title.textContent.trim().startsWith(prefix)) {
                  title.textContent = prefix + title.textContent.trim();
                }
              }
            } else {
              // hide duplicate cards for the same voyage
              card.classList.add("d-none");
            }
          });
        }
      });
      document.addEventListener("DOMContentLoaded", async () => {
        // Ensure nav links point to voyage pages
        document.querySelectorAll("a[data-voyage]").forEach((a) => {
          const v = a.getAttribute("data-voyage");
          if (!v || v === "all") return;
          const expected = `${VOYAGE_PAGE}?v=${v}`;
          const current = a.getAttribute("href") || "";
          if (current !== expected) a.setAttribute("href", expected);
        });

        // Load journal.json and render one card per voyage into #chapters-container
        try {
          const res = await fetch("src/data/journal.json");
          if (!res.ok) throw new Error("Không thể tải journal.json");
          const journal = await res.json();
          const container = document.getElementById("chapters-container");
          if (!container) return;

          container.innerHTML = ""; // clear existing markup

          // Create a card for each entry (assume entries are voyage-ordered v1..v7)
          journal.forEach((entry) => {
            const voyageId = (entry.id || "").replace(/^v/, "");
            const card = document.createElement("div");
            card.className = "chapter-card";
            card.setAttribute("data-voyage", voyageId);

            const body = document.createElement("div");
            body.className = "chapter-card-body";

            const number = document.createElement("div");
            number.className = "chapter-number";
            number.textContent = `${voyageId}`;

            const title = document.createElement("h3");
            title.className = "chapter-title";
            title.textContent = entry.title || `Hành trình ${voyageId}`;

            const meta = document.createElement("div");
            meta.className = "chapter-meta";
            const dateSpan = document.createElement("span");
            dateSpan.className = "meta-item";
            dateSpan.innerHTML = `<i class="fas fa-calendar-alt"></i> <span>${
              (entry.title || "").match(/\d{4}/) || ""
            }</span>`;
            meta.appendChild(dateSpan);

            const preview = document.createElement("p");
            preview.className = "chapter-preview";
            // Use first 220 characters of content as excerpt
            const excerpt = (entry.content || "")
              .replace(/\s+/g, " ")
              .trim()
              .slice(0, 220);
            preview.textContent =
              excerpt +
              (excerpt.length < (entry.content || "").length ? "…" : "");

            const readMore = document.createElement("a");
            readMore.className = "read-more-btn";
            readMore.href = `${VOYAGE_PAGE}?v=${voyageId}`;
            readMore.innerHTML = `Đọc thêm <i class="fas fa-arrow-right ms-2"></i>`;

            body.appendChild(number);
            body.appendChild(title);
            body.appendChild(meta);
            body.appendChild(preview);
            body.appendChild(readMore);

            card.appendChild(body);
            container.appendChild(card);
          });
        } catch (err) {
          console.error(err);
        }
      });

      document.addEventListener("DOMContentLoaded", () => {
        const container = document.getElementById("chapters-container");

        if (!container) return; // Dừng lại nếu không tìm thấy container

        container.addEventListener("click", (event) => {
          // 1. Tìm thẻ .chapter-card gần nhất mà người dùng đã nhấp vào
          const clickedCard = event.target.closest(".chapter-card");

          // 2. Nếu không nhấp vào thẻ (ví dụ: nhấp vào khoảng trống)
          //    hoặc nếu nhấp vào nút "Đọc thêm" (để đi sang trang khác),
          //    thì không làm gì cả.
          if (!clickedCard || event.target.closest(".read-more-btn")) {
            return;
          }

          // 3. Lấy thông tin vị trí của container và thẻ
          const containerRect = container.getBoundingClientRect();
          const cardRect = clickedCard.getBoundingClientRect();

          // 4. Tính toán vị trí cuộn mới để đưa thẻ vào giữa
          // Vị trí của thẻ (so với container) + (nửa chiều rộng thẻ) - (nửa chiều rộng container)
          const targetScrollLeft =
            container.scrollLeft +
            (cardRect.left - containerRect.left) +
            cardRect.width / 2 -
            containerRect.width / 2;

          // 5. Thực hiện cuộn mượt mà (chính là hiệu ứng "lướt")
          container.scrollTo({
            left: targetScrollLeft,
            behavior: "smooth",
          });
        });
      });
    </script>

    <script type="module" src="src/main.jsx"></script>
    <script type="module" src="src/diary-loader.js"></script>
  </body>
</html>
